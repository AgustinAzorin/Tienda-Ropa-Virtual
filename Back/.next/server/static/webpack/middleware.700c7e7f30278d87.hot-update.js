"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n\n\n/** Orígenes permitidos (Front local + producción) */ const ALLOWED_ORIGINS = [\n    'http://localhost:3000',\n    'http://127.0.0.1:3000',\n    process.env.NEXT_PUBLIC_FRONT_URL ?? ''\n].filter(Boolean);\n/** Paths que no requieren autenticación */ const PUBLIC_PATHS = [\n    '/api/auth',\n    '/api/catalog',\n    '/api/social/feed/discovery'\n];\nfunction getSecret() {\n    return new TextEncoder().encode(process.env.JWT_SECRET ?? '');\n}\n/** Agrega los headers CORS a una respuesta */ function withCors(response, origin) {\n    response.headers.set('Access-Control-Allow-Origin', origin);\n    response.headers.set('Access-Control-Allow-Credentials', 'true');\n    response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS');\n    response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-Requested-With');\n    response.headers.set('Access-Control-Max-Age', '86400');\n    return response;\n}\n/**\r\n * Next.js middleware:\r\n * - Maneja preflight CORS (OPTIONS) para todos los endpoints /api/*\r\n * - Verifica el JWT propio en rutas protegidas.\r\n * - Agrega x-user-id al header para que los Route Handlers lo consuman.\r\n */ async function middleware(request) {\n    const { pathname } = request.nextUrl;\n    if (!pathname.startsWith('/api')) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    // Determinar el origen de la petición\n    const origin = request.headers.get('origin') ?? '';\n    const isAllowedOrigin = ALLOWED_ORIGINS.includes(origin);\n    const corsOrigin = isAllowedOrigin ? origin : ALLOWED_ORIGINS[0];\n    // ── Preflight CORS ────────────────────────────────────────────────────────\n    if (request.method === 'OPTIONS') {\n        return withCors(new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, {\n            status: 204\n        }), corsOrigin);\n    }\n    // ── Rutas públicas (no requieren JWT) ────────────────────────────────────\n    if (PUBLIC_PATHS.some((p)=>pathname.startsWith(p))) {\n        const res = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return withCors(res, corsOrigin);\n    }\n    // ── Verificar JWT ─────────────────────────────────────────────────────────\n    const authHeader = request.headers.get('Authorization') ?? '';\n    if (!authHeader.startsWith('Bearer ')) {\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: {\n                code: 'UNAUTHORIZED',\n                message: 'Autenticación requerida'\n            }\n        }, {\n            status: 401\n        }), corsOrigin);\n    }\n    const token = authHeader.slice(7);\n    try {\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_1__.jwtVerify)(token, getSecret());\n        const userId = payload.sub;\n        const reqHeaders = new Headers(request.headers);\n        reqHeaders.set('x-user-id', userId);\n        const res = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n            request: {\n                headers: reqHeaders\n            }\n        });\n        return withCors(res, corsOrigin);\n    } catch  {\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: {\n                code: 'UNAUTHORIZED',\n                message: 'Token inválido o expirado'\n            }\n        }, {\n            status: 401\n        }), corsOrigin);\n    }\n}\nconst config = {\n    matcher: [\n        '/api/:path*'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUE2RDtBQUM1QjtBQUVqQyxtREFBbUQsR0FDbkQsTUFBTUUsa0JBQWtCO0lBQ3RCO0lBQ0E7SUFDQUMsUUFBUUMsR0FBRyxDQUFDQyxxQkFBcUIsSUFBSTtDQUN0QyxDQUFDQyxNQUFNLENBQUNDO0FBRVQseUNBQXlDLEdBQ3pDLE1BQU1DLGVBQWU7SUFDbkI7SUFDQTtJQUNBO0NBQ0Q7QUFFRCxTQUFTQztJQUNQLE9BQU8sSUFBSUMsY0FBY0MsTUFBTSxDQUFDUixRQUFRQyxHQUFHLENBQUNRLFVBQVUsSUFBSTtBQUM1RDtBQUVBLDRDQUE0QyxHQUM1QyxTQUFTQyxTQUFTQyxRQUFzQixFQUFFQyxNQUFjO0lBQ3RERCxTQUFTRSxPQUFPLENBQUNDLEdBQUcsQ0FBQywrQkFBK0JGO0lBQ3BERCxTQUFTRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxvQ0FBb0M7SUFDekRILFNBQVNFLE9BQU8sQ0FBQ0MsR0FBRyxDQUNsQixnQ0FDQTtJQUVGSCxTQUFTRSxPQUFPLENBQUNDLEdBQUcsQ0FDbEIsZ0NBQ0E7SUFFRkgsU0FBU0UsT0FBTyxDQUFDQyxHQUFHLENBQUMsMEJBQTBCO0lBQy9DLE9BQU9IO0FBQ1Q7QUFFQTs7Ozs7Q0FLQyxHQUNNLGVBQWVJLFdBQVdDLE9BQW9CO0lBQ25ELE1BQU0sRUFBRUMsUUFBUSxFQUFFLEdBQUdELFFBQVFFLE9BQU87SUFFcEMsSUFBSSxDQUFDRCxTQUFTRSxVQUFVLENBQUMsU0FBUyxPQUFPdEIscURBQVlBLENBQUN1QixJQUFJO0lBRTFELHNDQUFzQztJQUN0QyxNQUFNUixTQUFTSSxRQUFRSCxPQUFPLENBQUNRLEdBQUcsQ0FBQyxhQUFhO0lBQ2hELE1BQU1DLGtCQUFrQnZCLGdCQUFnQndCLFFBQVEsQ0FBQ1g7SUFDakQsTUFBTVksYUFBYUYsa0JBQWtCVixTQUFTYixlQUFlLENBQUMsRUFBRTtJQUVoRSw2RUFBNkU7SUFDN0UsSUFBSWlCLFFBQVFTLE1BQU0sS0FBSyxXQUFXO1FBQ2hDLE9BQU9mLFNBQVMsSUFBSWIscURBQVlBLENBQUMsTUFBTTtZQUFFNkIsUUFBUTtRQUFJLElBQUlGO0lBQzNEO0lBRUEsNEVBQTRFO0lBQzVFLElBQUluQixhQUFhc0IsSUFBSSxDQUFDLENBQUNDLElBQU1YLFNBQVNFLFVBQVUsQ0FBQ1MsS0FBSztRQUNwRCxNQUFNQyxNQUFNaEMscURBQVlBLENBQUN1QixJQUFJO1FBQzdCLE9BQU9WLFNBQVNtQixLQUFLTDtJQUN2QjtJQUVBLDZFQUE2RTtJQUM3RSxNQUFNTSxhQUFhZCxRQUFRSCxPQUFPLENBQUNRLEdBQUcsQ0FBQyxvQkFBb0I7SUFDM0QsSUFBSSxDQUFDUyxXQUFXWCxVQUFVLENBQUMsWUFBWTtRQUNyQyxPQUFPVCxTQUNMYixxREFBWUEsQ0FBQ2tDLElBQUksQ0FDZjtZQUFFQyxPQUFPO2dCQUFFQyxNQUFNO2dCQUFnQkMsU0FBUztZQUEwQjtRQUFFLEdBQ3RFO1lBQUVSLFFBQVE7UUFBSSxJQUVoQkY7SUFFSjtJQUVBLE1BQU1XLFFBQVFMLFdBQVdNLEtBQUssQ0FBQztJQUUvQixJQUFJO1FBQ0YsTUFBTSxFQUFFQyxPQUFPLEVBQUUsR0FBRyxNQUFNdkMsK0NBQVNBLENBQUNxQyxPQUFPN0I7UUFDM0MsTUFBTWdDLFNBQVNELFFBQVFFLEdBQUc7UUFFMUIsTUFBTUMsYUFBYSxJQUFJQyxRQUFRekIsUUFBUUgsT0FBTztRQUM5QzJCLFdBQVcxQixHQUFHLENBQUMsYUFBYXdCO1FBQzVCLE1BQU1ULE1BQU1oQyxxREFBWUEsQ0FBQ3VCLElBQUksQ0FBQztZQUFFSixTQUFTO2dCQUFFSCxTQUFTMkI7WUFBVztRQUFFO1FBQ2pFLE9BQU85QixTQUFTbUIsS0FBS0w7SUFDdkIsRUFBRSxPQUFNO1FBQ04sT0FBT2QsU0FDTGIscURBQVlBLENBQUNrQyxJQUFJLENBQ2Y7WUFBRUMsT0FBTztnQkFBRUMsTUFBTTtnQkFBZ0JDLFNBQVM7WUFBNEI7UUFBRSxHQUN4RTtZQUFFUixRQUFRO1FBQUksSUFFaEJGO0lBRUo7QUFDRjtBQUVPLE1BQU1rQixTQUFTO0lBQ3BCQyxTQUFTO1FBQUM7S0FBYztBQUMxQixFQUFFIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHBjXFxPbmVEcml2ZVxcRG9jdW1lbnRvc1xcR2l0SHViXFxUaWVuZGEtUm9wYS1WaXJ0dWFsXFxCYWNrXFxzcmNcXG1pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBqd3RWZXJpZnkgfSBmcm9tICdqb3NlJztcclxuXHJcbi8qKiBPcsOtZ2VuZXMgcGVybWl0aWRvcyAoRnJvbnQgbG9jYWwgKyBwcm9kdWNjacOzbikgKi9cclxuY29uc3QgQUxMT1dFRF9PUklHSU5TID0gW1xyXG4gICdodHRwOi8vbG9jYWxob3N0OjMwMDAnLFxyXG4gICdodHRwOi8vMTI3LjAuMC4xOjMwMDAnLFxyXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZST05UX1VSTCA/PyAnJyxcclxuXS5maWx0ZXIoQm9vbGVhbik7XHJcblxyXG4vKiogUGF0aHMgcXVlIG5vIHJlcXVpZXJlbiBhdXRlbnRpY2FjacOzbiAqL1xyXG5jb25zdCBQVUJMSUNfUEFUSFMgPSBbXHJcbiAgJy9hcGkvYXV0aCcsICAgICAgICAgIC8vIGxvZ2luLCByZWdpc3RlciwgT0F1dGggeSB0b2RvcyBsb3Mgc3ViLWVuZHBvaW50c1xyXG4gICcvYXBpL2NhdGFsb2cnLFxyXG4gICcvYXBpL3NvY2lhbC9mZWVkL2Rpc2NvdmVyeScsXHJcbl07XHJcblxyXG5mdW5jdGlvbiBnZXRTZWNyZXQoKTogVWludDhBcnJheSB7XHJcbiAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShwcm9jZXNzLmVudi5KV1RfU0VDUkVUID8/ICcnKTtcclxufVxyXG5cclxuLyoqIEFncmVnYSBsb3MgaGVhZGVycyBDT1JTIGEgdW5hIHJlc3B1ZXN0YSAqL1xyXG5mdW5jdGlvbiB3aXRoQ29ycyhyZXNwb25zZTogTmV4dFJlc3BvbnNlLCBvcmlnaW46IHN0cmluZyk6IE5leHRSZXNwb25zZSB7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsIG9yaWdpbik7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJywgJ3RydWUnKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldChcclxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJyxcclxuICAgICdHRVQsIFBPU1QsIFBVVCwgUEFUQ0gsIERFTEVURSwgT1BUSU9OUycsXHJcbiAgKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldChcclxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJyxcclxuICAgICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24sIFgtUmVxdWVzdGVkLVdpdGgnLFxyXG4gICk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLU1heC1BZ2UnLCAnODY0MDAnKTtcclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBOZXh0LmpzIG1pZGRsZXdhcmU6XHJcbiAqIC0gTWFuZWphIHByZWZsaWdodCBDT1JTIChPUFRJT05TKSBwYXJhIHRvZG9zIGxvcyBlbmRwb2ludHMgL2FwaS8qXHJcbiAqIC0gVmVyaWZpY2EgZWwgSldUIHByb3BpbyBlbiBydXRhcyBwcm90ZWdpZGFzLlxyXG4gKiAtIEFncmVnYSB4LXVzZXItaWQgYWwgaGVhZGVyIHBhcmEgcXVlIGxvcyBSb3V0ZSBIYW5kbGVycyBsbyBjb25zdW1hbi5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxdWVzdC5uZXh0VXJsO1xyXG5cclxuICBpZiAoIXBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGknKSkgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XHJcblxyXG4gIC8vIERldGVybWluYXIgZWwgb3JpZ2VuIGRlIGxhIHBldGljacOzblxyXG4gIGNvbnN0IG9yaWdpbiA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ29yaWdpbicpID8/ICcnO1xyXG4gIGNvbnN0IGlzQWxsb3dlZE9yaWdpbiA9IEFMTE9XRURfT1JJR0lOUy5pbmNsdWRlcyhvcmlnaW4pO1xyXG4gIGNvbnN0IGNvcnNPcmlnaW4gPSBpc0FsbG93ZWRPcmlnaW4gPyBvcmlnaW4gOiBBTExPV0VEX09SSUdJTlNbMF07XHJcblxyXG4gIC8vIOKUgOKUgCBQcmVmbGlnaHQgQ09SUyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcclxuICBpZiAocmVxdWVzdC5tZXRob2QgPT09ICdPUFRJT05TJykge1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKG5ldyBOZXh0UmVzcG9uc2UobnVsbCwgeyBzdGF0dXM6IDIwNCB9KSwgY29yc09yaWdpbik7XHJcbiAgfVxyXG5cclxuICAvLyDilIDilIAgUnV0YXMgcMO6YmxpY2FzIChubyByZXF1aWVyZW4gSldUKSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcclxuICBpZiAoUFVCTElDX1BBVEhTLnNvbWUoKHApID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocCkpKSB7XHJcbiAgICBjb25zdCByZXMgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKHJlcywgY29yc09yaWdpbik7XHJcbiAgfVxyXG5cclxuICAvLyDilIDilIAgVmVyaWZpY2FyIEpXVCDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcclxuICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnQXV0aG9yaXphdGlvbicpID8/ICcnO1xyXG4gIGlmICghYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcclxuICAgIHJldHVybiB3aXRoQ29ycyhcclxuICAgICAgTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogeyBjb2RlOiAnVU5BVVRIT1JJWkVEJywgbWVzc2FnZTogJ0F1dGVudGljYWNpw7NuIHJlcXVlcmlkYScgfSB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfSxcclxuICAgICAgKSxcclxuICAgICAgY29yc09yaWdpbixcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc2xpY2UoNyk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgZ2V0U2VjcmV0KCkpO1xyXG4gICAgY29uc3QgdXNlcklkID0gcGF5bG9hZC5zdWIgYXMgc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0IHJlcUhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXF1ZXN0LmhlYWRlcnMpO1xyXG4gICAgcmVxSGVhZGVycy5zZXQoJ3gtdXNlci1pZCcsIHVzZXJJZCk7XHJcbiAgICBjb25zdCByZXMgPSBOZXh0UmVzcG9uc2UubmV4dCh7IHJlcXVlc3Q6IHsgaGVhZGVyczogcmVxSGVhZGVycyB9IH0pO1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKHJlcywgY29yc09yaWdpbik7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gd2l0aENvcnMoXHJcbiAgICAgIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6IHsgY29kZTogJ1VOQVVUSE9SSVpFRCcsIG1lc3NhZ2U6ICdUb2tlbiBpbnbDoWxpZG8gbyBleHBpcmFkbycgfSB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfSxcclxuICAgICAgKSxcclxuICAgICAgY29yc09yaWdpbixcclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIG1hdGNoZXI6IFsnL2FwaS86cGF0aConXSxcclxufTtcclxuXHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJqd3RWZXJpZnkiLCJBTExPV0VEX09SSUdJTlMiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfRlJPTlRfVVJMIiwiZmlsdGVyIiwiQm9vbGVhbiIsIlBVQkxJQ19QQVRIUyIsImdldFNlY3JldCIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiSldUX1NFQ1JFVCIsIndpdGhDb3JzIiwicmVzcG9uc2UiLCJvcmlnaW4iLCJoZWFkZXJzIiwic2V0IiwibWlkZGxld2FyZSIsInJlcXVlc3QiLCJwYXRobmFtZSIsIm5leHRVcmwiLCJzdGFydHNXaXRoIiwibmV4dCIsImdldCIsImlzQWxsb3dlZE9yaWdpbiIsImluY2x1ZGVzIiwiY29yc09yaWdpbiIsIm1ldGhvZCIsInN0YXR1cyIsInNvbWUiLCJwIiwicmVzIiwiYXV0aEhlYWRlciIsImpzb24iLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwidG9rZW4iLCJzbGljZSIsInBheWxvYWQiLCJ1c2VySWQiLCJzdWIiLCJyZXFIZWFkZXJzIiwiSGVhZGVycyIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});